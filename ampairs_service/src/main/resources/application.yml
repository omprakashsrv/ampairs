server:
  compression:
    enabled: true
  tomcat:
    max-connections: 50
    accesslog:
      enabled: true
      pattern: "%h %l %u %t %r %s %b %D %{Referer}i %{User-Agent}i %{Request-Source}i"
      prefix: access_log
      suffix: .log
      file-date-format: .yyyy-MM-dd
      rotate: true
      renameOnRotate: true
      max-days: 10
      directory: logs
    threads:
      max: 50
      min-spare: 10
    accept-count: 50
    connection-timeout: 30000
  port: 8080
logging:
  logback:
    rollingpolicy:
      max-history: 7
      max-file-size: 1000MB
  file:
    path: logs/
    name: ${logging.file.path}production.log
  pattern:
    file: "%highlight(%-5level) [%date] [%thread] [%X{traceId:-}] [%cyan(%logger{0})] : %message%n"
    console: "%highlight(%-5level) [%date] [%thread] [%X{traceId:-}] [%cyan(%logger{0})]: %message%n"

spring:
  jackson:
    property-naming-strategy: SNAKE_CASE
  cache:
    type: caffeine
    caffeine:
      spec: maximumSize=10000,expireAfterAccess=1800s
  datasource:
    url: jdbc:mysql://localhost:3306/munsi_app
    username: root
    password: pass
    driver-class-name: com.mysql.cj.jdbc.Driver
    hikari:
      pool-name: main-db-pool
      maximum-pool-size: 20
      minimum-idle: 10
      connection-timeout: 20000
      idle-timeout: 60000
      max-lifetime: 300000
      validation-timeout: 5000
      leak-detection-threshold: 300000
  jpa:
    hibernate:
      naming:
        physical-strategy: org.hibernate.boot.model.naming.CamelCaseToUnderscoresNamingStrategy
      ddl-auto: update
  # Spring Cloud AWS Auto-configuration
  cloud:
    aws:
      region:
        static: ${AWS_REGION:ap-south-1}
        auto: ${AWS_AUTO_REGION:true}
      credentials:
        access-key: ${AWS_ACCESS_KEY:}
        secret-key: ${AWS_SECRET_KEY:}
        instance-profile: ${AWS_USE_IAM_ROLE:true}
        profile-name: ${AWS_PROFILE_NAME:}
        profile-path: ${AWS_PROFILE_PATH:}
      s3:
        region: ${AWS_S3_REGION:}
        endpoint: ${AWS_S3_ENDPOINT:}
        path-style-access-enabled: ${AWS_S3_PATH_STYLE:false}
        checksum-validation-enabled: ${AWS_S3_CHECKSUM_VALIDATION:true}
        chunked-encoding-disabled: ${AWS_S3_CHUNKED_ENCODING_DISABLED:false}
        accelerate-mode-enabled: ${AWS_S3_ACCELERATE_MODE:false}
        dualstack-enabled: ${AWS_S3_DUALSTACK:false}
      sns:
        region: ${AWS_SNS_REGION:}
        endpoint: ${AWS_SNS_ENDPOINT:}
      stack:
        auto: ${AWS_STACK_AUTO:false}
        name: ${AWS_STACK_NAME:}

# Application-specific AWS properties
ampairs:
  aws:
    s3:
      default-bucket: ${AWS_S3_BUCKET:ampairs-files}
      upload-folder: ${AWS_S3_UPLOAD_FOLDER:uploads}
      max-file-size: ${AWS_S3_MAX_FILE_SIZE:10MB}
      allowed-content-types: ${AWS_S3_ALLOWED_CONTENT_TYPES:image/jpeg,image/png,image/gif,image/webp,application/pdf,text/plain,application/json}
    sns:
      enabled: ${AWS_SNS_ENABLED:true}
      default-sender-id: ${AWS_SNS_SENDER_ID:AMPAIR}
      sms-type: ${AWS_SNS_SMS_TYPE:Transactional}
bucket4j:
  enabled: ${BUCKET4J_ENABLED:true}  # Rate limiting enabled
  cache-to-use: caffeine
  filters:
    - cache-name: rate-limit-bucket
      url: /auth/v1/init
      http-content-type: application/json
      rate-limits:
        - cache-key: "getRemoteAddr()"
          bandwidths:
            - capacity: 1
              time: 20
              unit: seconds
      http-response-body: '{"success": false, "error": {"code": "RATE_LIMIT_EXCEEDED", "message": "Too many requests. Please try again later.", "details": "Rate limit exceeded for your IP address"}, "timestamp": "${timestamp}", "path": "${path}"}'
    - cache-name: rate-limit-bucket
      url: /api/.*
      http-content-type: application/json
      rate-limits:
        - cache-key: "getRemoteAddr()"
          bandwidths:
            - capacity: 20
              time: 1
              unit: minutes
      http-response-body: '{"success": false, "error": {"code": "RATE_LIMIT_EXCEEDED", "message": "Too many requests. Please try again later.", "details": "Rate limit exceeded for your IP address"}, "timestamp": "${timestamp}", "path": "${path}"}'
    - cache-name: rate-limit-bucket
      url: /.*
      http-content-type: application/json
      rate-limits:
        - cache-key: "getRemoteAddr()"
          bandwidths:
            - capacity: 60
              time: 1
              unit: minutes
      http-response-body: '{"success": false, "error": {"code": "RATE_LIMIT_EXCEEDED", "message": "Too many requests. Please try again later.", "details": "Rate limit exceeded for your IP address"}, "timestamp": "${timestamp}", "path": "${path}"}'

application:
  multitenancy:
    enabled: true
  security:
    jwt:
      secret-key: ${JWT_SECRET_KEY:404E635266556A586E3272357538782F413F4428472B4B6250645367566B5970}
      expiration: ${JWT_EXPIRATION:PT24H} # 24 hours
      refresh-token:
        expiration: ${JWT_REFRESH_EXPIRATION:P180D} # 180 days
    cors:
      allowed-origins: ${CORS_ALLOWED_ORIGINS:http://localhost:3000,http://localhost:3001}
      allowed-methods: ${CORS_ALLOWED_METHODS:GET,POST,PUT,DELETE,OPTIONS}
      allowed-headers: ${CORS_ALLOWED_HEADERS:*}
      allow-credentials: ${CORS_ALLOW_CREDENTIALS:true}
      max-age: ${CORS_MAX_AGE:PT1H}
    token-cleanup:
      enabled: ${TOKEN_CLEANUP_ENABLED:true}
      cron: ${TOKEN_CLEANUP_CRON:0 0 2 * * ?} # Daily at 2 AM
      batch-size: ${TOKEN_CLEANUP_BATCH_SIZE:100} # Process tokens in batches
  cache:
    default-ttl: ${CACHE_DEFAULT_TTL:PT30M}
    max-size: ${CACHE_MAX_SIZE:10000}
    rate-limit-cache:
      expire-after-access: ${CACHE_RATE_LIMIT_EXPIRE:PT15M}
      maximum-size: ${CACHE_RATE_LIMIT_MAX_SIZE:10000}
  integration:
    tally:
      base-url: ${TALLY_BASE_URL:http://localhost:9000}
      connection-timeout: ${TALLY_CONNECTION_TIMEOUT:PT30S}
      read-timeout: ${TALLY_READ_TIMEOUT:PT2M}
      retry-attempts: ${TALLY_RETRY_ATTEMPTS:3}
      retry-delay: ${TALLY_RETRY_DELAY:PT5S}
      sync:
        customers:
          enabled: ${TALLY_SYNC_CUSTOMERS_ENABLED:true}
          cron-expression: ${TALLY_SYNC_CUSTOMERS_CRON:0 0 * * * *}
          batch-size: ${TALLY_SYNC_CUSTOMERS_BATCH_SIZE:100}
        products:
          enabled: ${TALLY_SYNC_PRODUCTS_ENABLED:true}
          cron-expression: ${TALLY_SYNC_PRODUCTS_CRON:0 0 * * * *}
          batch-size: ${TALLY_SYNC_PRODUCTS_BATCH_SIZE:100}
    notifications:
      email:
        enabled: ${NOTIFICATIONS_EMAIL_ENABLED:true}
        from: ${NOTIFICATIONS_EMAIL_FROM:noreply@ampairs.com}
      sms:
        enabled: ${NOTIFICATIONS_SMS_ENABLED:true}
        provider: ${NOTIFICATIONS_SMS_PROVIDER:aws-sns}
debug: false

# Google reCAPTCHA v3 Configuration
google:
  recaptcha:
    enabled: ${RECAPTCHA_ENABLED:true}
    secret-key: ${RECAPTCHA_SECRET_KEY:6LeIxAcTAAAAAGG-vFI1TnRWxMZNFuojJ4WifJWe}  # Test secret key for development
    site-key: ${RECAPTCHA_SITE_KEY:6LeIxAcTAAAAAJcZVRqyHh71UMIEGNQ_MXjiZKhI}    # Reference only - used by frontend
    verify-url: ${RECAPTCHA_VERIFY_URL:https://www.google.com/recaptcha/api/siteverify}
    min-score: ${RECAPTCHA_MIN_SCORE:0.5}
    timeout-ms: ${RECAPTCHA_TIMEOUT_MS:5000}
    actions:
      login: ${RECAPTCHA_ACTION_LOGIN:login}
      verify-otp: ${RECAPTCHA_ACTION_VERIFY_OTP:verify_otp}
      resend-otp: ${RECAPTCHA_ACTION_RESEND_OTP:resend_otp}

# Notification Configuration
notification:
  # Batch processing settings
  batch-size: ${NOTIFICATION_BATCH_SIZE:10}
  retry-delay-minutes: ${NOTIFICATION_RETRY_DELAY_MINUTES:5}
  cleanup-days: ${NOTIFICATION_CLEANUP_DAYS:30}

  # Parallel processing settings
  parallel-threads: ${NOTIFICATION_PARALLEL_THREADS:5}
  thread-pool:
    queue-capacity: ${NOTIFICATION_THREAD_POOL_QUEUE_CAPACITY:100}
    keep-alive-seconds: ${NOTIFICATION_THREAD_POOL_KEEP_ALIVE_SECONDS:60}

  # SMS Configuration
  sms:
    # Primary SMS provider (MSG91 or AWS_SNS)
    primary-provider: ${SMS_PRIMARY_PROVIDER:MSG91}

    # SMS Template Configuration
    sender-name: ${SMS_SENDER_NAME:AMPAIR}
    app-name: ${SMS_APP_NAME:Ampairs}
    support-url: ${SMS_SUPPORT_URL:https://ampairs.com/support}

    # MSG91 Configuration
    msg91:
      enabled: ${SMS_MSG91_ENABLED:true}
      auth-key: ${MSG91_AUTH_KEY:}
      template-id: ${MSG91_TEMPLATE_ID:}
      sender-id: ${MSG91_SENDER_ID:AMPAIR}
      api-url: ${MSG91_API_URL:https://control.msg91.com/api/v5/otp}
      use-template: ${MSG91_USE_TEMPLATE:false}

    # AWS SNS Configuration (references aws.sns section above)
    aws-sns:
      enabled: ${SMS_AWS_SNS_ENABLED:true}

  # Email Configuration (future)
  email:
    enabled: ${EMAIL_ENABLED:false}
    primary-provider: ${EMAIL_PRIMARY_PROVIDER:SMTP}

  # WhatsApp Configuration (future)
  whatsapp:
    enabled: ${WHATSAPP_ENABLED:false}
    primary-provider: ${WHATSAPP_PRIMARY_PROVIDER:TWILIO}
