<!-- Create Invitation Dialog -->
<div class="create-invitation-dialog">
  <!-- Dialog Header -->
  <div mat-dialog-title class="dialog-header">
    <div class="header-content">
      <div class="header-info">
        <mat-icon class="header-icon">person_add</mat-icon>
        <div class="title-section">
          <h2 class="dialog-title">Send Invitations</h2>
          <p class="dialog-subtitle">Invite new members to join your workspace</p>
        </div>
      </div>
      
      <div class="header-actions">
        <button 
          mat-icon-button
          (click)="toggleBulkMode()"
          [matTooltip]="isBulkMode ? 'Switch to single mode' : 'Switch to bulk mode'"
          class="bulk-toggle">
          <mat-icon>{{ isBulkMode ? 'person' : 'group_add' }}</mat-icon>
        </button>
        
        <button 
          mat-icon-button 
          (click)="onCancel()"
          class="close-button"
          matTooltip="Close">
          <mat-icon>close</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Dialog Content -->
  <div mat-dialog-content class="dialog-content">
    <form [formGroup]="invitationForm" class="invitation-form">
      
      <!-- Invitations List -->
      <div class="invitations-section">
        <div class="section-header">
          <h3 class="section-title">
            <mat-icon>mail_outline</mat-icon>
            Invitation Details
          </h3>
          <div class="invitation-counter">
            {{ getValidInvitations().length }} / {{ maxInvitations }} invitations
          </div>
        </div>

        <div class="invitations-list" formArrayName="invitations">
          <mat-card 
            *ngFor="let invitation of invitations.controls; let i = index"
            class="invitation-card"
            [formGroupName]="i">
            
            <mat-card-header class="invitation-header">
              <div class="invitation-number">
                <div class="number-badge">{{ i + 1 }}</div>
              </div>
              
              <mat-card-title class="invitation-title">
                Invitation {{ i + 1 }}
              </mat-card-title>
              
              <div class="invitation-actions">
                <button
                  *ngIf="invitations.length > 1"
                  mat-icon-button
                  (click)="removeInvitation(i)"
                  matTooltip="Remove invitation"
                  class="remove-button"
                  type="button">
                  <mat-icon>close</mat-icon>
                </button>
              </div>
            </mat-card-header>

            <mat-card-content class="invitation-content">
              <div class="form-grid">
                <!-- Email Field (Required) -->
                <mat-form-field appearance="outline" class="email-field">
                  <mat-label>Email Address *</mat-label>
                  <input 
                    matInput 
                    formControlName="email"
                    placeholder="user@example.com"
                    type="email">
                  <mat-icon matSuffix>email</mat-icon>
                  <mat-error *ngIf="invitation.get('email')?.hasError('required')">
                    Email is required
                  </mat-error>
                  <mat-error *ngIf="invitation.get('email')?.hasError('email')">
                    Please enter a valid email
                  </mat-error>
                </mat-form-field>

                <!-- Name Field (Optional) -->
                <mat-form-field appearance="outline" class="name-field">
                  <mat-label>Full Name</mat-label>
                  <input 
                    matInput 
                    formControlName="name"
                    placeholder="John Doe">
                  <mat-icon matSuffix>person</mat-icon>
                </mat-form-field>

                <!-- Phone Field (Optional) -->
                <mat-form-field appearance="outline" class="phone-field">
                  <mat-label>Phone Number</mat-label>
                  <input 
                    matInput 
                    formControlName="phone"
                    placeholder="+1 (555) 123-4567"
                    type="tel">
                  <mat-icon matSuffix>phone</mat-icon>
                </mat-form-field>

                <!-- Role Selection -->
                <mat-form-field appearance="outline" class="role-field">
                  <mat-label>Role *</mat-label>
                  <mat-select formControlName="role">
                    <mat-option 
                      *ngFor="let role of availableRoles" 
                      [value]="role">
                      <div class="role-option">
                        <mat-chip [color]="getRoleColor(role)" class="role-chip">
                          {{ role }}
                        </mat-chip>
                        <span class="role-desc">{{ getRoleDescription(role) }}</span>
                      </div>
                    </mat-option>
                  </mat-select>
                  <mat-icon matSuffix>admin_panel_settings</mat-icon>
                </mat-form-field>
              </div>
            </mat-card-content>
          </mat-card>
        </div>

        <!-- Add More Button -->
        <div class="add-invitation-section">
          <button
            *ngIf="invitations.length < maxInvitations"
            mat-stroked-button
            (click)="addInvitation()"
            class="add-invitation-btn"
            type="button">
            <mat-icon>add</mat-icon>
            Add Another Invitation
          </button>
          
          <div *ngIf="invitations.length >= maxInvitations" class="max-reached">
            <mat-icon>info</mat-icon>
            Maximum {{ maxInvitations }} invitations allowed
          </div>
        </div>
      </div>

      <!-- Advanced Options -->
      <mat-expansion-panel class="advanced-options">
        <mat-expansion-panel-header>
          <mat-panel-title>
            <mat-icon>settings</mat-icon>
            Advanced Options
          </mat-panel-title>
          <mat-panel-description>
            Customize invitation settings
          </mat-panel-description>
        </mat-expansion-panel-header>

        <div class="advanced-content">
          <!-- Custom Message -->
          <mat-form-field appearance="outline" class="message-field">
            <mat-label>Custom Message (Optional)</mat-label>
            <textarea 
              matInput 
              formControlName="customMessage"
              rows="3"
              placeholder="Add a personal message to your invitations...">
            </textarea>
            <mat-icon matSuffix>message</mat-icon>
            <mat-hint>This message will be included in the invitation email</mat-hint>
          </mat-form-field>

          <!-- Notification Options -->
          <div class="notification-options">
            <mat-checkbox formControlName="notifyInvitees">
              Send email notifications to invitees
            </mat-checkbox>
          </div>

          <!-- Quick Actions -->
          <div class="quick-actions">
            <button
              mat-button
              (click)="addCommonRoles()"
              type="button"
              class="quick-action">
              <mat-icon>group_add</mat-icon>
              Add Common Roles
            </button>
          </div>
        </div>
      </mat-expansion-panel>
    </form>
  </div>

  <!-- Dialog Actions -->
  <div mat-dialog-actions class="dialog-actions">
    <div class="actions-info">
      <div *ngIf="getValidInvitations().length > 0" class="valid-count">
        <mat-icon class="success-icon">check_circle</mat-icon>
        {{ getValidInvitations().length }} valid invitation{{ getValidInvitations().length > 1 ? 's' : '' }}
      </div>
    </div>
    
    <div class="actions-buttons">
      <!-- Loading Spinner -->
      <mat-spinner 
        *ngIf="isLoading" 
        diameter="24" 
        class="action-spinner">
      </mat-spinner>
      
      <!-- Cancel Button -->
      <button
        mat-button
        (click)="onCancel()"
        [disabled]="isLoading">
        Cancel
      </button>
      
      <!-- Send Button -->
      <button
        mat-raised-button
        color="primary"
        (click)="onSend()"
        [disabled]="!isFormValid() || isLoading"
        class="send-button">
        <mat-icon>send</mat-icon>
        Send {{ getValidInvitations().length > 1 ? 'Invitations' : 'Invitation' }}
      </button>
    </div>
  </div>
</div>