<!-- Modern Workspace Invitations Management -->
<div class="invitations-container">
  
  <!-- Header Section with Clean Typography -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon class="title-icon">mail_outline</mat-icon>
          Invitations
          <mat-chip class="invitation-count" [color]="'primary'">
            {{ totalElements || 0 }}
          </mat-chip>
        </h1>
        <p class="page-subtitle">Manage workspace invitations and track their status</p>
      </div>
      
      <div class="header-actions">
        <button 
          (click)="createNewInvitation()" 
          mat-fab 
          color="primary" 
          class="invite-fab"
          matTooltip="Send new invitations"
          [matTooltipPosition]="'left'">
          <mat-icon>person_add</mat-icon>
        </button>
        
        <button 
          (click)="viewMembers()" 
          mat-stroked-button 
          class="secondary-action">
          <mat-icon>group</mat-icon>
          View Members
        </button>
        
        <button 
          [matMenuTriggerFor]="actionsMenu" 
          mat-icon-button 
          class="more-actions"
          matTooltip="More actions">
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Statistics Cards - Simplified -->
  <div *ngIf="!isLoadingStats && invitationStats" class="stats-section">
    <div class="stats-row">
      <mat-card class="stat-card total">
        <mat-card-content>
          <div class="stat-value">{{ invitationStats.total_sent || 0 }}</div>
          <div class="stat-label">Total Sent</div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card accepted">
        <mat-card-content>
          <div class="stat-value">{{ invitationStats.total_accepted || 0 }}</div>
          <div class="stat-label">Accepted</div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card pending">
        <mat-card-content>
          <div class="stat-value">{{ invitationStats.total_pending || 0 }}</div>
          <div class="stat-label">Pending</div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card rate">
        <mat-card-content>
          <div class="stat-value">{{ (invitationStats.acceptance_rate * 100).toFixed(1) }}%</div>
          <div class="stat-label">Acceptance Rate</div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Invitations List - Card Based Design -->
  <div class="invitations-section">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <mat-spinner diameter="48"></mat-spinner>
      <p class="loading-text">Loading invitations...</p>
    </div>

    <!-- Invitations Grid -->
    <div *ngIf="!isLoading && dataSource.data.length > 0" class="invitations-grid">
      <mat-card 
        *ngFor="let invitation of dataSource.data; trackBy: trackByInvitationId"
        class="invitation-card"
        (click)="viewInvitationDetails(invitation)"
        [class.expired]="isExpired(invitation.expires_at)"
        [class.accepted]="invitation.status === 'ACCEPTED'"
        [class.pending]="invitation.status === 'PENDING'">
        
        <mat-card-content class="invitation-content">
          <!-- Email and Basic Info -->
          <div class="invitation-header">
            <div class="invitation-avatar">
              <div class="avatar-placeholder">
                {{ invitation.email.charAt(0).toUpperCase() }}
              </div>
              <div 
                *ngIf="invitation.status === 'ACCEPTED'" 
                class="status-indicator accepted">
              </div>
              <div 
                *ngIf="invitation.status === 'PENDING'" 
                class="status-indicator pending">
              </div>
            </div>
            
            <div class="invitation-info">
              <h3 class="invitation-email">{{ invitation.email }}</h3>
              <p class="invitation-role">{{ invitation.role }}</p>
            </div>
          </div>

          <!-- Status and Details -->
          <div class="invitation-details">
            <mat-chip [color]="getInvitationStatusColor(invitation.status)" class="status-chip">
              {{ invitation.status }}
            </mat-chip>
            
            <mat-chip 
              [color]="getDeliveryStatusColor(invitation.delivery_status)" 
              class="delivery-chip">
              {{ invitation.delivery_status }}
            </mat-chip>
          </div>

          <!-- Meta Information -->
          <div class="invitation-meta">
            <div class="meta-row">
              <span class="meta-item">
                <mat-icon class="meta-icon">person</mat-icon>
                Invited by {{ invitation.inviter_name }}
              </span>
            </div>
            <div class="meta-row">
              <span class="meta-item">
                <mat-icon class="meta-icon">schedule</mat-icon>
                {{ formatDate(invitation.created_at) }}
              </span>
            </div>
            <div class="meta-row">
              <span class="meta-item expires" [class.expired]="isExpired(invitation.expires_at)">
                <mat-icon class="meta-icon">event</mat-icon>
                {{ getInvitationTimeRemaining(invitation.expires_at) }}
              </span>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="invitation-actions">
            <button 
              mat-icon-button 
              (click)="resendInvitation(invitation); $event.stopPropagation()"
              [disabled]="!canResend(invitation)"
              matTooltip="Resend invitation">
              <mat-icon>send</mat-icon>
            </button>
            
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="invitationQuickActions"
              [matMenuTriggerData]="{ invitation: invitation }"
              (click)="$event.stopPropagation()"
              matTooltip="More actions">
              <mat-icon>more_horiz</mat-icon>
            </button>
          </div>

          <!-- Custom Message Indicator -->
          <div *ngIf="invitation.custom_message" class="message-indicator">
            <mat-icon class="message-icon">message</mat-icon>
            <span class="message-text">Custom message included</span>
          </div>

          <!-- Reminder Count -->
          <div *ngIf="invitation.reminder_count > 0" class="reminder-count">
            <mat-icon 
              [matBadge]="invitation.reminder_count" 
              matBadgeColor="accent">
              notification_important
            </mat-icon>
            <span class="reminder-text">{{ invitation.reminder_count }} reminder{{ invitation.reminder_count > 1 ? 's' : '' }} sent</span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && dataSource.data.length === 0" class="empty-state">
      <mat-icon class="empty-icon">mail_outline</mat-icon>
      <h2>No invitations found</h2>
      <p>Start building your team by sending invitations to potential members.</p>
      <button 
        (click)="createNewInvitation()" 
        mat-raised-button 
        color="primary" 
        class="empty-action">
        <mat-icon>person_add</mat-icon>
        Send Invitations
      </button>
    </div>

    <!-- Pagination -->
    <mat-paginator
      *ngIf="!isLoading && totalElements > 0"
      (page)="onPageChange($event)"
      [length]="totalElements"
      [pageSizeOptions]="[12, 24, 48]"
      [pageSize]="pageSize"
      [showFirstLastButtons]="true"
      class="invitations-paginator">
    </mat-paginator>
  </div>
</div>

<!-- Actions Menu -->
<mat-menu #actionsMenu="matMenu">
  <button (click)="exportInvitations('CSV')" mat-menu-item>
    <mat-icon>download</mat-icon>
    Export as CSV
  </button>
  <button (click)="exportInvitations('EXCEL')" mat-menu-item>
    <mat-icon>table_chart</mat-icon>
    Export as Excel
  </button>
  <mat-divider></mat-divider>
  <button (click)="refresh()" mat-menu-item>
    <mat-icon>refresh</mat-icon>
    Refresh
  </button>
</mat-menu>

<!-- Invitation Quick Actions Menu -->
<mat-menu #invitationQuickActions="matMenu">
  <ng-template let-invitation="invitation" matMenuContent>
    <button 
      (click)="viewInvitationDetails(invitation)" 
      mat-menu-item>
      <mat-icon>visibility</mat-icon>
      View Details
    </button>
    
    <button 
      (click)="resendInvitation(invitation)" 
      [disabled]="!canResend(invitation)"
      mat-menu-item>
      <mat-icon>send</mat-icon>
      Resend Invitation
    </button>
    
    <mat-divider></mat-divider>
    
    <button 
      (click)="cancelInvitation(invitation)"
      [disabled]="!canCancel(invitation)"
      mat-menu-item>
      <mat-icon>cancel</mat-icon>
      Cancel Invitation
    </button>
    
    <button 
      (click)="deleteInvitation(invitation)"
      class="danger-action"
      mat-menu-item>
      <mat-icon>delete</mat-icon>
      Delete Invitation
    </button>
  </ng-template>
</mat-menu>