<!-- Modern Workspace Members Management -->
<div class="members-container">
  
  <!-- Header Section with Clean Typography -->
  <div class="page-header">
    <div class="header-content">
      <div class="title-section">
        <h1 class="page-title">
          <mat-icon class="title-icon">group</mat-icon>
          Members
          <mat-chip class="member-count" [color]="'primary'">
            {{ totalElements || 0 }}
          </mat-chip>
        </h1>
        <p class="page-subtitle">Manage your workspace team members and their permissions</p>
      </div>
      
      <div class="header-actions">
        <button 
          (click)="inviteNewMembers()" 
          mat-fab 
          color="primary" 
          class="invite-fab"
          matTooltip="Invite new members"
          [matTooltipPosition]="'left'">
          <mat-icon>person_add</mat-icon>
        </button>
        
        <button 
          (click)="viewInvitations()" 
          mat-stroked-button 
          class="secondary-action">
          <mat-icon>mail_outline</mat-icon>
          Invitations
        </button>
        
        <button 
          [matMenuTriggerFor]="actionsMenu" 
          mat-icon-button 
          class="more-actions"
          matTooltip="More actions">
          <mat-icon>more_vert</mat-icon>
        </button>
      </div>
    </div>
  </div>

  <!-- Statistics Cards - Simplified -->
  <div *ngIf="!isLoadingStats && memberStats" class="stats-section">
    <div class="stats-row">
      <mat-card class="stat-card total">
        <mat-card-content>
          <div class="stat-value">{{ memberStats.total_members || 0 }}</div>
          <div class="stat-label">Total Members</div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card active">
        <mat-card-content>
          <div class="stat-value">{{ memberStats.active_members || 0 }}</div>
          <div class="stat-label">Active</div>
        </mat-card-content>
      </mat-card>
      
      <mat-card class="stat-card recent">
        <mat-card-content>
          <div class="stat-value">{{ memberStats.recent_joins || 0 }}</div>
          <div class="stat-label">Recent Joins</div>
        </mat-card-content>
      </mat-card>
    </div>
  </div>

  <!-- Members List - Card Based Design -->
  <div class="members-section">
    
    <!-- Loading State -->
    <div *ngIf="isLoading" class="loading-state">
      <mat-spinner diameter="48"></mat-spinner>
      <p class="loading-text">Loading members...</p>
    </div>

    <!-- Members Grid -->
    <div *ngIf="!isLoading && dataSource.data.length > 0" class="members-grid">
      <mat-card 
        *ngFor="let member of dataSource.data; trackBy: trackByMemberId"
        class="member-card"
        (click)="viewMemberDetails(member)"
        [class.online]="member.is_online">
        
        <mat-card-content class="member-content">
          <!-- Avatar and Basic Info -->
          <div class="member-header">
            <div class="member-avatar">
              <img 
                *ngIf="member.avatar_url; else avatarFallback"
                [src]="member.avatar_url" 
                [alt]="getDisplayName(member)"
                class="avatar-image">
              <ng-template #avatarFallback>
                <div class="avatar-placeholder">
                  {{ (getDisplayName(member) || '?').charAt(0).toUpperCase() }}
                </div>
              </ng-template>
              <div *ngIf="member.is_online" class="online-indicator"></div>
            </div>
            
            <div class="member-info">
              <h3 class="member-name">{{ getDisplayName(member) }}</h3>
              <p class="member-email">{{ member.email }}</p>
            </div>
          </div>

          <!-- Role and Status -->
          <div class="member-details">
            <mat-chip [color]="getRoleColor(member.role)" class="role-chip">
              {{ member.role }}
            </mat-chip>
            
            <mat-chip 
              [color]="getStatusColor(member.status)" 
              class="status-chip"
              [class.inactive]="member.status !== 'ACTIVE'">
              {{ member.status }}
            </mat-chip>
          </div>

          <!-- Quick Actions -->
          <div class="member-actions">
            <button 
              mat-icon-button 
              (click)="editMemberRole(member); $event.stopPropagation()"
              [disabled]="!canManageMember(member.role)"
              matTooltip="Edit role">
              <mat-icon>edit</mat-icon>
            </button>
            
            <button 
              mat-icon-button 
              [matMenuTriggerFor]="memberQuickActions"
              [matMenuTriggerData]="{ member: member }"
              (click)="$event.stopPropagation()"
              matTooltip="More actions">
              <mat-icon>more_horiz</mat-icon>
            </button>
          </div>

          <!-- Join Date -->
          <div class="member-meta">
            <span class="join-date">
              <mat-icon class="meta-icon">schedule</mat-icon>
              Joined {{ formatJoinedDate(member.joined_at) }}
            </span>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Empty State -->
    <div *ngIf="!isLoading && dataSource.data.length === 0" class="empty-state">
      <mat-icon class="empty-icon">group_off</mat-icon>
      <h2>No members found</h2>
      <p>Start building your team by inviting members to your workspace.</p>
      <button 
        (click)="inviteNewMembers()" 
        mat-raised-button 
        color="primary" 
        class="empty-action">
        <mat-icon>person_add</mat-icon>
        Invite Members
      </button>
    </div>

    <!-- Pagination -->
    <mat-paginator
      *ngIf="!isLoading && totalElements > 0"
      (page)="onPageChange($event)"
      [length]="totalElements"
      [pageSizeOptions]="[12, 24, 48]"
      [pageSize]="pageSize"
      [showFirstLastButtons]="true"
      class="members-paginator">
    </mat-paginator>
  </div>
</div>

<!-- Actions Menu -->
<mat-menu #actionsMenu="matMenu">
  <button (click)="exportMembers('CSV')" mat-menu-item>
    <mat-icon>download</mat-icon>
    Export as CSV
  </button>
  <button (click)="exportMembers('EXCEL')" mat-menu-item>
    <mat-icon>table_chart</mat-icon>
    Export as Excel
  </button>
  <mat-divider></mat-divider>
  <button (click)="refresh()" mat-menu-item>
    <mat-icon>refresh</mat-icon>
    Refresh
  </button>
</mat-menu>

<!-- Member Quick Actions Menu -->
<mat-menu #memberQuickActions="matMenu">
  <ng-template let-member="member" matMenuContent>
    <button 
      (click)="viewMemberDetails(member)" 
      mat-menu-item>
      <mat-icon>visibility</mat-icon>
      View Details
    </button>
    
    <button 
      (click)="editMemberRole(member)" 
      [disabled]="!canManageMember(member.role)"
      mat-menu-item>
      <mat-icon>admin_panel_settings</mat-icon>
      Edit Role
    </button>
    
    <mat-divider></mat-divider>
    
    <button 
      (click)="updateMemberStatus(member, 'ACTIVE')"
      *ngIf="member.status !== 'ACTIVE'"
      [disabled]="!canManageMember(member.role)"
      mat-menu-item>
      <mat-icon>play_circle</mat-icon>
      Activate
    </button>
    
    <button 
      (click)="updateMemberStatus(member, 'INACTIVE')"
      *ngIf="member.status === 'ACTIVE'"
      [disabled]="!canManageMember(member.role)"
      mat-menu-item>
      <mat-icon>pause_circle</mat-icon>
      Deactivate
    </button>
    
    <mat-divider *ngIf="canManageMember(member.role)"></mat-divider>
    
    <button 
      (click)="removeMember(member)"
      [disabled]="!canManageMember(member.role)"
      class="danger-action"
      mat-menu-item>
      <mat-icon>person_remove</mat-icon>
      Remove Member
    </button>
  </ng-template>
</mat-menu>