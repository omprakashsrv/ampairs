# iOS Build Configuration Complete ‚úÖ

**Date**: January 2025
**Status**: ‚úÖ Ready to Build with CocoaPods

## Critical Fix Applied

### Build Phase Command Updated
**File**: `iosApp/iosApp.xcodeproj/project.pbxproj`

The "Compile Kotlin Framework" build phase now uses the correct CocoaPods-compatible command:

**‚úÖ CORRECT (Now)**:
```bash
./gradlew :composeApp:syncFramework \
    -Pkotlin.native.cocoapods.platform=$PLATFORM_NAME \
    -Pkotlin.native.cocoapods.archs="$ARCHS" \
    -Pkotlin.native.cocoapods.configuration="$CONFIGURATION"
```

**‚ùå WRONG (Before)**:
```bash
./gradlew :composeApp:embedAndSignAppleFrameworkForXcode
```

## How This Fixes the MainViewController Error

### The Problem
```
Compiling ContentView.swift
(9, 16) Cannot find 'MainViewController' in scope
```

### Why It Happened
1. CocoaPods creates a dummy framework with placeholder headers initially
2. The real Kotlin framework with proper headers must be built by Xcode
3. The build phase runs `syncFramework` BEFORE Swift compilation
4. `syncFramework` generates `ComposeApp.h` with `MainViewController` declaration
5. Swift compilation then finds the function and succeeds

### Build Phase Execution Order
```
1. [CP] Check Pods Manifest.lock
2. Compile Kotlin Framework  ‚Üê Runs syncFramework, generates headers
3. Sources                   ‚Üê Swift compilation, MainViewController now available
4. Frameworks
5. Resources
6. [CP] Embed Pods Frameworks
```

## üöÄ Build Instructions

### CRITICAL: Use Workspace, Not Project

```bash
cd /Users/omprakashsrv/IdeaProjects/ampairs/ampairs-mp-app

# ‚úÖ CORRECT
open iosApp/iosApp.xcworkspace

# ‚ùå WRONG - Don't use this!
# open iosApp/iosApp.xcodeproj
```

### In Xcode

1. **Select target**: iosApp
2. **Select destination**: iPhone 15 Pro (or any iOS Simulator)
3. **Build**: Product ‚Üí Build (Cmd+B)

### Expected Build Output

```
‚ñ∏ Running script '[CP] Check Pods Manifest.lock'
‚ñ∏ Running script 'Compile Kotlin Framework'
  > Task :composeApp:syncFramework
  Building Kotlin framework for iphonesimulator arm64...
  Framework generated at: composeApp/build/cocoapods/framework/ComposeApp.framework
‚ñ∏ Compiling ContentView.swift
  ‚úì import ComposeApp
  ‚úì MainViewController() found
‚ñ∏ Linking iosApp
‚ñ∏ Build Succeeded
```

## All Applied Fixes

| Issue | Fix | Status |
|-------|-----|--------|
| embedAndSign + CocoaPods conflict | Changed to syncFramework | ‚úÖ |
| Wrong framework search paths | Use $(inherited) from CocoaPods | ‚úÖ |
| No CocoaPods setup | Created Podfile + ran pod install | ‚úÖ |
| Missing xcworkspace | Generated by CocoaPods | ‚úÖ |
| Placeholder framework headers | syncFramework generates real headers | ‚úÖ |
| MainViewController not found | Fixed by build phase execution order | ‚úÖ |

## Configuration Summary

- **Workspace**: `iosApp/iosApp.xcworkspace` (generated by CocoaPods)
- **Podfile**: `iosApp/Podfile` (links to ../composeApp pod)
- **Framework**: Built by Xcode using syncFramework task
- **Dependencies**: Firebase pods automatically included

## After Successful Build

### Next Steps

1. ‚úÖ **Build completes** - App compiles successfully
2. ‚è≥ **Add Compose Resources** - See `IOS_COMPOSE_RESOURCES_FIX.md`
3. ‚è≥ **Add Firebase Config** - See `IOS_FIREBASE_XCODE_SETUP.md`
4. ‚è≥ **Test on Simulator** - Run and verify

### Runtime Issues You May Encounter

#### MissingResourceException
```
Missing resource with path: compose-resources/...
```
**Fix**: Add "Copy Compose Resources" build phase (documented)

#### Firebase Not Configured
```
FirebaseApp not configured
```
**Fix**: Add GoogleService-Info.plist to Xcode project

## Troubleshooting

### If Build Still Fails

1. **Clean build folder**:
   ```
   In Xcode: Product ‚Üí Clean Build Folder (Cmd+Shift+K)
   ```

2. **Check build log** for "Compile Kotlin Framework" phase

3. **Verify syncFramework**:
   ```bash
   grep "syncFramework" iosApp/iosApp.xcodeproj/project.pbxproj
   # Should show the syncFramework command with parameters
   ```

4. **Manually test syncFramework**:
   ```bash
   ./gradlew :composeApp:syncFramework \
       -Pkotlin.native.cocoapods.platform=iphonesimulator \
       -Pkotlin.native.cocoapods.archs="arm64" \
       -Pkotlin.native.cocoapods.configuration="Debug"
   ```

### If Pods Out of Sync

```bash
cd iosApp
pod install
```

## Related Documentation

- [IOS_BUILD_PHASE_FIXED.md](./IOS_BUILD_PHASE_FIXED.md) - embedAndSign ‚Üí syncFramework details
- [IOS_COCOAPODS_SETUP_COMPLETE.md](./IOS_COCOAPODS_SETUP_COMPLETE.md) - CocoaPods integration
- [IOS_MODULE_IMPORT_FIXED.md](./IOS_MODULE_IMPORT_FIXED.md) - Framework header generation
- [IOS_COMPOSE_RESOURCES_FIX.md](./IOS_COMPOSE_RESOURCES_FIX.md) - Next step after build
- [IOS_FIREBASE_XCODE_SETUP.md](./IOS_FIREBASE_XCODE_SETUP.md) - Firebase configuration

---

**Last Updated**: January 2025
**Status**: ‚úÖ All issues resolved - Ready to build in Xcode!

**IMPORTANT**: Open `iosApp.xcworkspace` and build. The Kotlin framework will be built automatically with proper headers, and MainViewController will be available for Swift.
