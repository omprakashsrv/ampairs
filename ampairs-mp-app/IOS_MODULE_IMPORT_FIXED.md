# iOS Module Import Fixed - MainViewController Found

**Date**: January 2025
**Status**: ✅ Fixed

## Problem

After setting up CocoaPods, Xcode was showing:
```
Compiling ContentView.swift
Compile ContentView.swift (arm64)
(9, 16) Cannot find 'MainViewController' in scope
```

## Root Cause

The framework at `composeApp/build/cocoapods/framework/ComposeApp.framework/` had only a **placeholder header** instead of the real Objective-C header file that exports Kotlin functions to Swift.

### What Was Wrong

**File**: `composeApp/build/cocoapods/framework/ComposeApp.framework/Headers/placeholder.h`
```objc
// Autogenerated placeholder header. Do not edit manually.
```

This placeholder header doesn't include the `MainViewController` function declaration, so Swift couldn't find it.

### What Should Be There

**File**: `composeApp/build/cocoapods/framework/ComposeApp.framework/Headers/ComposeApp.h` (2.8 MB)
```objc
__attribute__((swift_name("MainViewControllerKt")))
@interface ComposeAppMainViewControllerKt : ComposeAppBase
+ (UIViewController *)MainViewController __attribute__((swift_name("MainViewController()")));
@end
```

## Solution Applied

Copied the **complete framework** from the debug build output to the CocoaPods location:

```bash
rm -rf composeApp/build/cocoapods/framework/ComposeApp.framework

cp -R composeApp/build/bin/iosSimulatorArm64/debugFramework/ComposeApp.framework \
      composeApp/build/cocoapods/framework/
```

### Files Now Present
- ✅ `ComposeApp.framework/ComposeApp` - Binary (446 MB debug build)
- ✅ `ComposeApp.framework/Headers/ComposeApp.h` - **Real header** (2.8 MB)
- ✅ `ComposeApp.framework/Modules/module.modulemap` - Module definition
- ✅ `ComposeApp.framework/Info.plist` - Framework metadata

## Verification

### Check Header Exists
```bash
ls -lh composeApp/build/cocoapods/framework/ComposeApp.framework/Headers/ComposeApp.h
# Should show: 2.8M file size
```

### Check MainViewController Declaration
```bash
grep "MainViewController" composeApp/build/cocoapods/framework/ComposeApp.framework/Headers/ComposeApp.h
# Should show: + (UIViewController *)MainViewController ...
```

### Check Module Map
```bash
cat composeApp/build/cocoapods/framework/ComposeApp.framework/Modules/module.modulemap
# Should show: umbrella header "ComposeApp.h"
```

## Build in Xcode

1. **Clean build folder** (important!):
   ```
   In Xcode: Product → Clean Build Folder (Cmd+Shift+K)
   ```

2. **Build again**:
   ```
   Product → Build (Cmd+B)
   ```

3. **Expected result**: No more "Cannot find 'MainViewController'" error!

## Why This Happened

The `syncFramework` Gradle task is designed to be **run by Xcode** during the build process. It:
1. Compiles the Kotlin code
2. Generates the framework with proper headers
3. Copies it to the CocoaPods location

However, when running `pod install` initially, the framework didn't exist yet, so CocoaPods created a placeholder.

## Automatic Build Process

When you build from Xcode, the **"Build composeApp"** build phase script automatically runs:

```bash
"$REPO_ROOT/../gradlew" -p "$REPO_ROOT" $KOTLIN_PROJECT_PATH:syncFramework \
    -Pkotlin.native.cocoapods.platform=$PLATFORM_NAME \
    -Pkotlin.native.cocoapods.archs="$ARCHS" \
    -Pkotlin.native.cocoapods.configuration="$CONFIGURATION"
```

This script (from `composeApp.podspec`) ensures the framework is built correctly with all headers before Swift compilation.

## If Issue Happens Again

### Symptom
```
Cannot find 'MainViewController' in scope
```

### Quick Fix
```bash
# 1. Rebuild the Kotlin framework
./gradlew :composeApp:linkDebugFrameworkIosSimulatorArm64

# 2. Copy to CocoaPods location
rm -rf composeApp/build/cocoapods/framework/ComposeApp.framework
cp -R composeApp/build/bin/iosSimulatorArm64/debugFramework/ComposeApp.framework \
      composeApp/build/cocoapods/framework/

# 3. Clean Xcode build
# In Xcode: Cmd+Shift+K

# 4. Build again
# In Xcode: Cmd+B
```

### Root Cause Check
```bash
# Check if header is placeholder
cat composeApp/build/cocoapods/framework/ComposeApp.framework/Headers/*.h

# If you see "Autogenerated placeholder", the framework needs to be rebuilt
```

## What ContentView.swift Imports

```swift
import ComposeApp  // This imports the framework module

// MainViewController() is now available because:
// 1. ComposeApp.h declares: + (UIViewController *)MainViewController
// 2. With swift_name attribute: __attribute__((swift_name("MainViewController()")))
// 3. So Swift sees it as: func MainViewController() -> UIViewController
```

## Related Files

- **Podspec**: `composeApp/composeApp.podspec` - Defines framework location
- **Build Script**: Script phase in podspec runs `syncFramework`
- **Module Map**: `ComposeApp.framework/Modules/module.modulemap`
- **Swift Code**: `iosApp/iosApp/ContentView.swift` - Imports and uses

## Status

| Component | Status |
|-----------|--------|
| Framework Binary | ✅ 446 MB debug build |
| Framework Headers | ✅ ComposeApp.h (2.8 MB) |
| Module Map | ✅ Correct umbrella header |
| MainViewController | ✅ Declared in header |
| Swift Import | ✅ Should compile now |

## Next Steps After Build Succeeds

1. ⏳ Add "Copy Compose Resources" build phase (see IOS_COMPOSE_RESOURCES_FIX.md)
2. ⏳ Add GoogleService-Info.plist for Firebase (see IOS_FIREBASE_XCODE_SETUP.md)
3. ⏳ Test app on iOS simulator

---

**Last Updated**: January 2025
**Status**: ✅ Framework headers fixed, ready to build in Xcode
